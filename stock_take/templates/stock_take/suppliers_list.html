{% extends 'base.html' %}
{% load static %}

{% block title %}Suppliers{% endblock %}

{% block page_title %}
    Suppliers <span class="page-title-count">{{ total_count }}</span>
{% endblock %}

{% block nav_suppliers_active %}active{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/suppliers.css' %}">
{% endblock %}

{% block content %}
<div class="content-card">
    <div class="suppliers-toolbar">
        <p class="suppliers-note">
            <i class="bi bi-info-circle"></i>
            Supplier data is extracted from Purchase Orders during sync. You can also
            <a href="{% url 'purchase_orders_list' %}">sync Purchase Orders</a> or add suppliers manually.
        </p>
        <button class="btn-add-supplier" onclick="document.getElementById('addSupplierModal').style.display='flex'">
            <i class="bi bi-plus-lg"></i> Add Supplier
        </button>
    </div>

    {% if suppliers %}
    <div class="suppliers-table-container">
        <table class="suppliers-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>City</th>
                    <th>Country</th>
                    <th class="text-right">POs</th>
                    <th class="text-right">Total Spend</th>
                    <th>Active</th>
                </tr>
            </thead>
            <tbody>
                {% for supplier in suppliers %}
                <tr>
                    <td>
                        <a href="{% url 'supplier_detail' supplier.workguru_id %}" class="supplier-name-link">
                            {{ supplier.name|default:"-" }}
                        </a>
                    </td>
                    <td>
                        {% if supplier.email %}
                        <a href="mailto:{{ supplier.email }}" class="supplier-email">{{ supplier.email }}</a>
                        {% else %}-{% endif %}
                    </td>
                    <td>{{ supplier.phone|default:"-" }}</td>
                    <td>{{ supplier.city|default:"-" }}</td>
                    <td>{{ supplier.country|default:"-" }}</td>
                    <td class="text-right">{{ supplier.po_count }}</td>
                    <td class="text-right">Â£{{ supplier.total_spend|floatformat:2 }}</td>
                    <td>
                        {% if supplier.is_active %}
                        <span class="supplier-active-badge active">Active</span>
                        {% else %}
                        <span class="supplier-active-badge inactive">Inactive</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="suppliers-empty-state">
        <i class="bi bi-building"></i>
        <p>No suppliers found. Sync Purchase Orders to populate supplier data.</p>
    </div>
    {% endif %}
</div>

<!-- Add Supplier Modal -->
<div class="modal-overlay" id="addSupplierModal" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <h2><i class="bi bi-building-add"></i> Add Supplier</h2>
            <button class="modal-close" onclick="document.getElementById('addSupplierModal').style.display='none'">&times;</button>
        </div>
        <form method="POST" action="{% url 'supplier_create' %}">
            {% csrf_token %}
            <div class="modal-body">
                <div class="form-group">
                    <label for="supplier-name">Name <span class="required">*</span></label>
                    <input type="text" id="supplier-name" name="name" required placeholder="Supplier name">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplier-email">Email</label>
                        <input type="email" id="supplier-email" name="email" placeholder="email@example.com">
                    </div>
                    <div class="form-group">
                        <label for="supplier-phone">Phone</label>
                        <input type="text" id="supplier-phone" name="phone" placeholder="Phone number">
                    </div>
                </div>
                <div class="form-group">
                    <label for="supplier-website">Website</label>
                    <input type="url" id="supplier-website" name="website" placeholder="https://...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="supplier-address">Address</label>
                        <input type="text" id="supplier-address" name="address_1" placeholder="Street address">
                    </div>
                    <div class="form-group">
                        <label for="supplier-city">City</label>
                        <input type="text" id="supplier-city" name="city" placeholder="City">
                    </div>
                </div>
                <div class="form-group">
                    <label for="supplier-country">Country</label>
                    <input type="text" id="supplier-country" name="country" placeholder="Country">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="document.getElementById('addSupplierModal').style.display='none'">Cancel</button>
                <button type="submit" class="btn-save"><i class="bi bi-check-lg"></i> Create Supplier</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
