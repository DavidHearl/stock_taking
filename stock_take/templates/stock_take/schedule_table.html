{% if user.is_authenticated %}
<table class="schedules-table">
    <thead>
        <tr>
            <th>Name</th>
            <th>Date</th>
            <th>Stock Take Groups</th>
            <th>Locations</th>
            <th>Priority</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for schedule in schedules %}
        <tr {% if schedule.is_overdue %}class="overdue"{% elif schedule.auto_generated %}class="auto-generated"{% endif %}>
                <td>
                <div class="schedule-name">
                    <strong>{{ schedule.name }}</strong>
                    {% if schedule.auto_generated %}
                        <span class="badge badge-info">Auto</span>
                    {% endif %}
                </div>
            </td>
            <td>
                <div class="schedule-date">
                    {% if schedule.status == 'completed' and schedule.completed_date %}
                        {{ schedule.completed_date|date:"M d, Y H:i" }}
                        <small class="schedule-date-completed">Completed</small>
                    {% else %}
                        {{ schedule.scheduled_date|date:"M d, Y H:i" }}
                        {% if schedule.is_overdue %}
                            <small class="schedule-date-overdue">Overdue</small>
                        {% endif %}
                    {% endif %}
                </div>
            </td>
            <td>
                <div class="groups-list">
                    {% for group in schedule.stock_take_groups.all %}
                        <span class="group-badge" style="background-color: {{ group.color }};">
                            {{ group.category.name }} - {{ group.name }}
                        </span>
                    {% empty %}
                        <span style="color: var(--text-secondary);">All groups</span>
                    {% endfor %}
                </div>
            </td>
            <td>
                {% if schedule.locations %}
                    {{ schedule.locations|truncatewords:3 }}
                {% else %}
                    <span style="color: var(--text-secondary);">All locations</span>
                {% endif %}
            </td>
            <td>
                {% if schedule.priority_score %}
                    <span class="priority-badge">{{ schedule.priority_score }}</span>
                {% else %}
                    <span style="color: var(--text-secondary);">-</span>
                {% endif %}
            </td>
            <td>
                <div class="action-buttons">
                    {% if schedule.status == 'pending' %}
                        <a href="{% url 'stock_take_detail' schedule.id %}" class="btn btn-primary" title="Start Stock Take">
                            ‚ñ∂Ô∏è
                        </a>
                    {% elif schedule.status == 'in_progress' %}
                        <a href="{% url 'stock_take_detail' schedule.id %}" class="btn btn-success" title="Continue Stock Take">
                            ‚Üí
                        </a>
                    {% endif %}
                    
                    <button class="btn btn-secondary edit-schedule-btn" 
                            data-id="{{ schedule.id }}" 
                            data-name="{{ schedule.name }}"
                            data-date="{{ schedule.scheduled_date|date:'Y-m-d\TH:i' }}"
                            data-description="{{ schedule.description }}"
                            data-locations="{{ schedule.locations }}"
                            data-assigned="{{ schedule.assigned_to }}"
                            data-notes="{{ schedule.notes }}"
                            title="Edit Schedule">
                        <i class="bi bi-pencil"></i>
                    </button>
                    
                    <a href="{% url 'export_stock_take_csv' schedule.id %}" class="btn btn-secondary" title="Export CSV">
                        üì•
                    </a>
                    
                    <button class="btn btn-danger delete-schedule-btn" 
                            data-id="{{ schedule.id }}" title="Delete">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}